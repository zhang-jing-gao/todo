"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const vue_1 = require("vue");
const evtd_1 = require("evtd");
const utils_1 = require("./utils");
const clickedTimeRef = vue_1.ref(undefined);
let usedCount = 0;
function handleClick() {
    clickedTimeRef.value = Date.now();
}
let managable = true;
function useClicked(timeout) {
    if (!utils_1.isBrowser)
        return vue_1.readonly(vue_1.ref(false));
    const clickedRef = vue_1.ref(false);
    let timerId = null;
    function clearTimer() {
        if (timerId !== null)
            window.clearTimeout(timerId);
    }
    function clickedHandler() {
        clearTimer();
        clickedRef.value = true;
        timerId = window.setTimeout(() => {
            clickedRef.value = false;
        }, timeout);
    }
    if (usedCount === 0) {
        evtd_1.on('click', window, handleClick, true);
    }
    const setup = () => {
        usedCount += 1;
        evtd_1.on('click', window, clickedHandler, true);
    };
    if (managable && (managable = utils_1.hasInstance())) {
        vue_1.onBeforeMount(setup);
        vue_1.onBeforeUnmount(() => {
            usedCount -= 1;
            if (usedCount === 0) {
                evtd_1.off('click', window, handleClick, true);
            }
            evtd_1.off('click', window, clickedHandler, true);
            clearTimer();
        });
    }
    else {
        setup();
    }
    return vue_1.readonly(clickedRef);
}
exports.default = useClicked;
